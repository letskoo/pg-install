#!/usr/bin/env node

import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const projectRoot = path.join(__dirname, "..");

const heroDir = path.join(projectRoot, "public", "images", "hero");
const outputDir = path.join(projectRoot, "src", "generated");
const outputFile = path.join(outputDir, "heroImages.ts");

const IMAGE_EXTENSIONS = [".jpg", ".jpeg", ".png", ".webp"];

console.log(`ğŸ“‚ Project root: ${projectRoot}`);
console.log(`ğŸ“‚ Hero dir: ${heroDir}`);
console.log(`ğŸ“ Output file: ${outputFile}`);

// ìƒì„±ëœ ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
  console.log(`âœ“ Created output directory: ${outputDir}`);
}

// hero ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ê²½ê³  í›„ ì¢…ë£Œ
if (!fs.existsSync(heroDir)) {
  console.warn(`âš ï¸  Warning: ${heroDir} does not exist. Creating empty heroImages.ts`);
  const emptyContent = `// Auto-generated file. Do not edit manually.\nexport const heroImages: string[] = [];\n`;
  fs.writeFileSync(outputFile, emptyContent, "utf-8");
  process.exit(0);
}

try {
  // public/images/hero í´ë”ì—ì„œ íŒŒì¼ ì½ê¸°
  const files = fs.readdirSync(heroDir);
  console.log(`ğŸ“„ Files in hero dir: ${files.join(", ")}`);

  // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í•„í„°ë§ (í™•ì¥ì í™•ì¸, ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
  const imageFiles = files
    .filter((file) => {
      const ext = path.extname(file).toLowerCase();
      const isImage = IMAGE_EXTENSIONS.includes(ext);
      if (!isImage) {
        console.log(`  âŠ˜ Skipping: ${file} (extension: ${ext})`);
      }
      return isImage;
    })
    .sort((a, b) => a.localeCompare(b, undefined, { numeric: true })); // ìì—° ì •ë ¬

  console.log(`âœ“ Filtered image files: ${imageFiles.join(", ")}`);

  // ì ˆëŒ€ ê²½ë¡œ ìƒì„±
  const imagePaths = imageFiles.map((file) => `/images/hero/${file}`);

  // TypeScript íŒŒì¼ ìƒì„±
  const content = `// Auto-generated file. Do not edit manually.
// Generated by scripts/generate-hero-images.mjs
// Run: npm run gen:hero

export const heroImages: string[] = ${JSON.stringify(imagePaths, null, 2)};
`;

  fs.writeFileSync(outputFile, content, "utf-8");
  console.log(`\nâœ… Generated ${outputFile}`);
  console.log(`ğŸ–¼ï¸  Found ${imagePaths.length} image(s)\n`);
} catch (error) {
  console.error("âŒ Error generating heroImages.ts:", error.message);
  process.exit(1);
}
